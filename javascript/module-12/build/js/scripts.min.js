"use strict";var API_KEY="5b95674e6df9cb84931d049a63cf56e0a47379c26c5cf",lStorageKey="urlList",LOCALSTORAGE=function(r){if(r){return{isActive:"localStorage"in r,get:function(r){try{var e=localStorage.getItem(r);return null===e?void 0:JSON.parse(e)}catch(r){console.error("Get state error: ",r)}},set:function(r,e){try{var t=JSON.stringify(e);localStorage.setItem(r,t)}catch(r){console.error("Set state error: ",r)}},remove:function(r){try{localStorage.removeItem(r)}catch(r){console.error("Get state error: ",r)}}}}}(window),urlList={arrUrl:[],setUrl:function(r){this.arrUrl.push(r)},getUrlLocalStorage:function(){LOCALSTORAGE.isActive&&void 0!==LOCALSTORAGE.get(lStorageKey)&&(this.arrUrl=LOCALSTORAGE.get(lStorageKey))},removeUrl:function(e){this.arrUrl=this.arrUrl.filter(function(r){return r.id!==e})}};urlList.getUrlLocalStorage();var CREATE_GRID=function(r){var e=document.querySelector(".cards-list"),t=document.querySelector("#template-card").innerHTML.trim(),a=Handlebars.compile(t),n=r.reverse().reduce(function(r,e){return r+a(e)},"");return e.innerHTML=n,{addNewCard:function(r){e.insertAdjacentHTML("afterbegin",a(r))}}}(urlList.arrUrl),form=document.querySelector(".js-form"),cards=document.querySelector(".cards-list");function handleFormSubmit(r){r.preventDefault();var e=form.querySelector("input");return null===e.value?alert("Enter your url adress!"):/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/g.test(e.value)?(getUrlInfo(e.value).then(function(r){if(urlList.arrUrl.map(function(r){return r.url}).includes(r.url))return alert("Your url adress is already exists!");var e=new Date,t=Math.random().toString(36).substr(2,9);r.id=e.getTime()+"-"+t,urlList.setUrl(r),CREATE_GRID.addNewCard(r),LOCALSTORAGE.isActive&&(LOCALSTORAGE.remove(lStorageKey),LOCALSTORAGE.set(lStorageKey,urlList.arrUrl))}),void(e.value="")):alert("Your url adress is not valid!")}function getUrlInfo(r){return fetch("https://api.linkpreview.net/?key="+API_KEY+"&q="+r).then(function(r){if(r.ok)return r.json();throw new Error("Error while fetching: "+r.statusText)}).catch(function(r){console.log("ERROR: ",r)})}function handleDeleteCard(r){var e=r.target;if("BUTTON"===e.nodeName){var t=e.parentNode,a=t.dataset.idItem;t.remove(),urlList.removeUrl(a),LOCALSTORAGE.isActive&&(LOCALSTORAGE.remove(lStorageKey),LOCALSTORAGE.set(lStorageKey,urlList.arrUrl))}}form.addEventListener("submit",handleFormSubmit),cards.addEventListener("click",handleDeleteCard);